<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="description" content="Eyeris - Real-time AI-powered eye tracking and blink detection dashboard">
  <meta name="theme-color" content="#09090b">
  <title>Eyeris â€” AI Eye Tracking</title>
  
  <!-- Chart.js v4.5.1 (local) -->
  <script src="lib/chart.umd.min.js"></script>
  <!-- Moment.js v2.30.1 (local) -->
  <script src="lib/moment.min.js"></script>
  <!-- Chart.js Moment Adapter v1.0.1 (local) -->
  <script src="lib/chartjs-adapter-moment.min.js"></script>
  
  <link rel="stylesheet" href="styles.css">
  
  <!-- Disable Service Worker in Tauri to prevent caching issues -->
  <script>
    (function() {
      const isTauri = window.__TAURI__ !== undefined || 
                      window.location.protocol === 'tauri:' || 
                      window.location.hostname === 'tauri.localhost';
      
      if (isTauri && 'serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          registrations.forEach(reg => reg.unregister());
        });
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
          });
        }
      }
    })();
  </script>
</head>
<body>
  <nav class="nav">
    <h2>
      <img src="icon.svg" alt="Eyeris">
      <span class="nav-brand">Eyeris</span>
    </h2>
    <ul>
      <li><a href="#dashboard" class="nav-link active" data-page="dashboard">Dashboard</a></li>
      <li><a href="#downloads" class="nav-link" data-page="downloads">Downloads</a></li>
      <li><a href="#docs" class="nav-link" data-page="docs">Docs</a></li>
      <li><a href="#about" class="nav-link" data-page="about">About</a></li>
    </ul>
  </nav>

  <!-- Persistent Mini Player - Shows when not on Dashboard -->
  <div id="miniPlayer" class="mini-player" style="display: none;">
    <div class="mini-player-content">
      <div class="mini-video-container">
        <video id="miniWebcam" autoplay playsinline muted></video>
        <div class="mini-status">
          <span class="mini-dot"></span>
          <span id="miniBlinkRate">--</span> blinks/min
        </div>
      </div>
      <div class="mini-stats">
        <span>â±ï¸ <span id="miniSessionTime">00:00</span></span>
        <span>ğŸ˜Œ <span id="miniStrainLevel">Low</span></span>
      </div>
      <button id="backToDashboard" class="mini-btn">â† Dashboard</button>
    </div>
  </div>

  <!-- Page Content Container -->
  <div id="pageContent">
    <!-- Dashboard Page (default) -->
    <div id="page-dashboard" class="page-section active">
      <main class="container">

    <section class="hero">
      <div class="hero-text">
        <h1>Protect Your Eyes</h1>
        <p>AI-powered eye strain detection with smart break reminders</p>
      </div>
    </section>

    <!-- Eye Health Status Banner -->
    <div class="health-banner" id="healthBanner">
      <div class="health-status">
        <div class="status-icon" id="statusIcon">âœ…</div>
        <div class="status-text">
          <h3 id="statusTitle">Eyes Looking Healthy</h3>
          <p id="statusMessage">Start tracking to monitor your eye health</p>
        </div>
      </div>
      <div class="next-break">
        <span class="break-label">Next Break</span>
        <span class="break-timer" id="breakTimer">--:--</span>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-icon green">ğŸ‘ï¸</div>
        <div class="stat-info">
          <h3 id="blinkRate">--</h3>
          <p>Blinks/min</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon cyan">â±ï¸</div>
        <div class="stat-info">
          <h3 id="sessionTime">00:00</h3>
          <p>Screen Time</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon purple">ğŸ˜Œ</div>
        <div class="stat-info">
          <h3 id="breaksTaken">0</h3>
          <p>Breaks Taken</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon orange">âš ï¸</div>
        <div class="stat-info">
          <h3 id="strainLevel">Low</h3>
          <p>Eye Strain</p>
        </div>
      </div>
    </div>

    <!-- Main Dashboard -->
    <section id="facelandmark">
      <div id="liveView" class="videoView">
        <button id="webcamButton" class="mdc-button mdc-button--raised">
          <span class="mdc-button__label">Start Monitoring</span>
        </button>
        
        <div class="video-container">
          <video id="webcam" autoplay playsinline></video>
          <canvas class="output_canvas" id="output_canvas"></canvas>
        </div>
        
        <ul class="blend-shapes-list" id="video-blend-shapes"></ul>
      </div>
      
      <div id="analysis" class="analysis_div">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-dot green"></span>
            <h3>Blink Rate Over Time</h3>
          </div>
          <span class="chart-badge">Live</span>
        </div>
        <p class="chart-desc">Healthy blink rate: 15-20 per minute. Low rate = eye strain risk.</p>
        <div class="chart-wrapper">
          <canvas id="eyeBlinkChart"></canvas>
        </div>
        <div class="metrics-grid">
          <div class="metric-box">
            <div class="metric-label">Left Eye</div>
            <div class="metric-value purple" id="leftEyeMetric">--%</div>
          </div>
          <div class="metric-box">
            <div class="metric-label">Right Eye</div>
            <div class="metric-value cyan" id="rightEyeMetric">--%</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 20-20-20 Rule Card -->
    <div class="rule-card">
      <div class="rule-header">
        <h3>ğŸ‘€ The 20-20-20 Rule</h3>
      </div>
      <div class="rule-content">
        <div class="rule-item">
          <div class="rule-number">20</div>
          <p>Every <strong>20 minutes</strong></p>
        </div>
        <div class="rule-divider">â†’</div>
        <div class="rule-item">
          <div class="rule-number">20</div>
          <p>Look at something <strong>20 feet</strong> away</p>
        </div>
        <div class="rule-divider">â†’</div>
        <div class="rule-item">
          <div class="rule-number">20</div>
          <p>For at least <strong>20 seconds</strong></p>
        </div>
      </div>
    </div>

    <!-- Health Charts -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-dot purple"></span>
            <h3>Real-time Eye Openness</h3>
          </div>
        </div>
        <p>Lower values may indicate fatigue or strain</p>
        <div class="chart-wrapper">
          <canvas id="realtimeChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-dot cyan"></span>
            <h3>Blink Distribution</h3>
          </div>
        </div>
        <p>Balanced blinking keeps both eyes healthy</p>
        <div class="chart-wrapper">
          <canvas id="blinkDistChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-dot green"></span>
            <h3>Eye Comfort Score</h3>
          </div>
        </div>
        <p>Based on blink rate and openness patterns</p>
        <div class="chart-wrapper">
          <canvas id="attentionChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-dot orange"></span>
            <h3>Strain Risk Level</h3>
          </div>
        </div>
        <p>ğŸŸ¢ Low &nbsp; ğŸŸ¡ Moderate &nbsp; ğŸ”´ High â€” Take a break!</p>
        <div class="chart-wrapper">
          <canvas id="fatigueChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Tips Section -->
    <div class="tips-grid">
      <div class="tip-card">
        <div class="tip-icon">ğŸ’¡</div>
        <h4>Proper Lighting</h4>
        <p>Avoid glare on your screen. Position lights to the side, not behind or in front of you.</p>
      </div>
      <div class="tip-card">
        <div class="tip-icon">ğŸ“</div>
        <h4>Screen Distance</h4>
        <p>Keep your screen at arm's length (about 25 inches) and slightly below eye level.</p>
      </div>
      <div class="tip-card">
        <div class="tip-icon">ğŸ’§</div>
        <h4>Stay Hydrated</h4>
        <p>Drink water regularly. Dehydration can worsen dry eyes and eye strain.</p>
      </div>
      <div class="tip-card">
        <div class="tip-icon">ğŸŒ™</div>
        <h4>Night Mode</h4>
        <p>Use dark mode or blue light filters, especially in the evening.</p>
      </div>
    </div>

    <section class="about">
      <h2>Why Eye Health Matters</h2>
      <p>Digital eye strain affects over 50% of computer users. Symptoms include dry eyes, headaches, blurred vision, and neck pain. Eyeris uses AI to monitor your blink rate â€” a key indicator of eye strain. When you stare at screens, your blink rate drops by up to 66%, causing dryness and fatigue. Our smart alerts remind you to take breaks before strain sets in.</p>
    </section>
      </main>
    </div>
    <!-- End Dashboard Page -->

    <!-- Downloads Page -->
    <div id="page-downloads" class="page-section">
      <main class="container">
        <section class="downloads">
          <h2>Downloads</h2>
          <p>Get the Eyeris application for your platform. All versions include real-time eye tracking powered by MediaPipe.</p>
          
          <div class="version-badge loading" id="versionBadge">
            <div class="loading-spinner"></div>
            <span>Loading latest release...</span>
          </div>

          <div id="downloadContent">
            <div class="loading-spinner" style="margin: 2rem auto;"></div>
          </div>

          <div class="download-grid" style="margin-top: 2rem;">
            <div class="download-card web-card">
              <h3><span class="platform-icon">ğŸŒ</span> Web Version</h3>
              <p>No download required! Use Eyeris directly in your browser with full functionality.</p>
              <a href="#" data-page="dashboard" class="nav-link web-btn">Open Web App â†’</a>
            </div>
            
            <div class="download-card">
              <h3><span class="platform-icon">ğŸ“¦</span> Source Code</h3>
              <p>View the source code, contribute, or build from source.</p>
              <ul class="download-links">
                <li>
                  <a href="https://github.com/imnexerio/Eyeris" target="_blank">
                    <span class="file-info">
                      <span class="file-name">GitHub Repository</span>
                      <span class="file-desc">View source & contribute</span>
                    </span>
                    <span>â†’</span>
                  </a>
                </li>
                <li>
                  <a href="https://github.com/imnexerio/Eyeris/releases" target="_blank">
                    <span class="file-info">
                      <span class="file-name">All Releases</span>
                      <span class="file-desc">View release history</span>
                    </span>
                    <span>â†’</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </section>
      </main>
    </div>
    <!-- End Downloads Page -->

    <!-- Docs Page -->
    <div id="page-docs" class="page-section">
      <main class="container">
        <section class="troubleshooting">
          <h2>Documentation</h2>
          
          <h3>ğŸ¯ How It Works</h3>
          <p>Eyeris uses MediaPipe's Face Landmarker model to detect 478 facial landmarks and 52 blendshape coefficients in real-time. The blendshapes include:</p>
          <p><strong>Eye tracking:</strong> eyeBlinkLeft, eyeBlinkRight, eyeLookDownLeft, eyeLookDownRight, eyeLookInLeft, eyeLookInRight, eyeLookOutLeft, eyeLookOutRight, eyeLookUpLeft, eyeLookUpRight, eyeSquintLeft, eyeSquintRight, eyeWideLeft, eyeWideRight</p>
          
          <h3>ğŸ“Š Understanding the Charts</h3>
          <p><strong>Blink History:</strong> Shows the ratio of closed-eye frames over time. Higher values indicate more frequent blinking.</p>
          <p><strong>Real-time Eye Openness:</strong> Live visualization of how open each eye is (1 = fully open, 0 = closed).</p>
          <p><strong>Attention Score:</strong> Average eye openness â€” lower scores may indicate fatigue or distraction.</p>
          <p><strong>Fatigue Indicator:</strong> Tracks blink rate over time. Normal is 15-20 blinks/min; higher rates may indicate eye strain.</p>
          
          <h3>ğŸ”§ Troubleshooting</h3>
          <p><strong>Camera not working?</strong> Make sure you've granted camera permissions in your browser. Check if another app is using the camera.</p>
          <p><strong>Low FPS?</strong> Close other browser tabs. Eyeris uses GPU acceleration â€” ensure your device supports WebGL.</p>
          <p><strong>Tracking inaccurate?</strong> Ensure good lighting on your face. Position yourself about arm's length from the camera.</p>
          
          <h3>ğŸ”— Resources</h3>
          <p><a href="https://ai.google.dev/edge/mediapipe/solutions/vision/face_landmarker" target="_blank">MediaPipe Face Landmarker Documentation</a></p>
        </section>
      </main>
    </div>
    <!-- End Docs Page -->

    <!-- About Page -->
    <div id="page-about" class="page-section">
      <main class="container">
        <section class="contact">
          <h2>About Eyeris</h2>
          <p>Eyeris is an open-source eye health monitoring app that helps you prevent digital eye strain. Using AI-powered blink detection, it reminds you to take breaks and maintain healthy screen habits.</p>
          
          <h3>ğŸ¯ The Problem</h3>
          <p>When staring at screens, our blink rate drops by up to 66% â€” from 15-20 blinks/min to just 5-7. This causes dry eyes, fatigue, headaches, and long-term vision problems. Over 50% of computer users experience digital eye strain.</p>
          
          <h3>ğŸ’¡ The Solution</h3>
          <p>Eyeris monitors your blink rate in real-time and alerts you when it drops too low. It also implements the 20-20-20 rule: every 20 minutes, look at something 20 feet away for 20 seconds.</p>

          <h3>âœ¨ Features</h3>
          <p>â€¢ Real-time blink rate monitoring<br>
          â€¢ Eye strain detection with visual alerts<br>
          â€¢ Smart 20-20-20 break reminders<br>
          â€¢ Session analytics and history<br>
          â€¢ Background monitoring (works in other tabs)<br>
          â€¢ 100% privacy â€” all processing is local</p>
          
          <h3>ğŸ›  Technology</h3>
          <p>Powered by <a href="https://ai.google.dev/edge/mediapipe/" target="_blank">MediaPipe</a> Face Landmarker, Chart.js for visualizations, and modern web APIs for camera access and background processing.</p>
          
          <h3>ğŸ“œ License</h3>
          <p>MIT License â€” free to use, modify, and distribute.</p>
          
          <h3>ğŸ‘¤ Contact</h3>
          <p>Find the project on <a href="https://github.com/imnexerio/Eyeris" target="_blank">GitHub</a></p>
        </section>
      </main>
    </div>
    <!-- End About Page -->
  </div>
  <!-- End Page Content Container -->

  <!-- Break Reminder Modal -->
  <div class="break-modal" id="breakModal">
    <div class="break-modal-content">
      <div class="break-emoji">ğŸ‘€</div>
      <h2>Time for an Eye Break!</h2>
      <p>Look at something 20 feet away for 20 seconds</p>
      <div class="break-countdown" id="breakCountdown">20</div>
      <button class="break-btn" id="skipBreakBtn">Skip Break</button>
      <button class="break-btn primary" id="startBreakBtn">Start 20s Timer</button>
    </div>
  </div>

  <footer class="footer">
    <p>
      <a href="https://github.com/imnexerio/Eyeris" target="_blank">GitHub</a>
      <a href="#" data-page="about" class="nav-link">About</a>
      <a href="https://ai.google.dev/edge/mediapipe/solutions/vision/face_landmarker" target="_blank">MediaPipe Docs</a>
    </p>
  </footer>

  <!-- Load SPA router first (non-module for immediate execution) -->
  <script src="spa-router.js"></script>
  <script src="downloads-loader.js"></script>
  <!-- Main app script -->
  <script src="script.js" type="module"></script>
  <!-- Tauri external links handler (loaded last, only affects external links) -->
  <script src="tauri-links.js" type="module"></script>
</body>
</html>
